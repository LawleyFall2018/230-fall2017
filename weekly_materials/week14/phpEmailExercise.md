# Week 14 Exercise: PHP Email Form 

## Overview & Goals
In today's exercise, you'll build a simple PHP contact form. Because it's easy for a form like this to be abused, rather than writing our own script, we're going to use one that's been developed to include some security features. 

## Downloading and Editing the Script

We're going to use a PHP script provided by a company called Tectite. Got to 
https://www.tectite.com/formmailpage.php. I've included the script in the [formmail.zip] archive, which you should download and extract now. 

Open the formmail.php file in an editor; you'll see that there is a good bit of documentation in the file itself. Under the "Quick Start" information, it tells you that the only thing you absolutely have to change in the script is the TARGET_EMAIL; it should include the domain to which the mail script can send email (in this case, we're going to restrict to only your email address). It also strongly suggests that you change the $DEF_ALERT value to your own email, which is particularly useful when you're testing a form that will be sent to another address. 

Scroll down to line 442 of the file. Edit the $TARGET_EMAIL line to this:

`$TARGET_EMAIL = array($EMAIL_NAME."@rit\.edu$");`

Right below that, edit the $DEF_ALERT line to include the same address:
`$DEF_ALERT = "your@email.here";`

If you want more information on these settings, and the others that are configurable, there are links in the script comments to the documentation. 

That's all you need to do! (Make sure you save the changes to the file.)

## Setting Up the Form
Take a look at the form.html file. 

Right now it isn't very useful, since it has no actions associated with it. You can click the button all you want--nothing will happen. 

Make the following changes to the form.html file:

1. Edit the form tag at the beginning of your form to use the URL to use the formmail.php on your website in the 'action' value, and set the form method to "post" (so that the contents of the form aren't put into the URL). 
```html
  <form method="post" action="formmail.php" name="ContactForm">
```

2. Add the following hidden input field below the form tag; it will retrieve information about the user's environment:
```html
  <input type="hidden" name="env_report" value="REMOTE_HOST,REMOTE_ADDR,HTTP_USER_AGENT,AUTH_TYPE,REMOTE_USER" />
```

3. Add a hidden 'recipients' input field with your email address as the value. ***Be sure to use an @rit.edu address, since we restricted emails to that domain!***
 ```html
  <input type="hidden" name="recipients" value="your@email.here" />
```

4. Add a hidden 'required' input field to specify that the EMailAddr and FullName fields must be filled in. (NOTE: DO NOT put your email address and name here. "Your email address" and "Your name" are error messages for your users to see, not placeholders for you to replace.)

```html
  <input type="hidden" name="required" value="EmailAddr:Your email address,FullName:Your name" />
```

5. Add a hidden 'subject' input field with the subject line you want the messages generated by the form to include.

```html
  <input type="hidden" name="subject" value="Test Mail from Contact Form" />
```

6. In your original form, make the following changes, so that the formmail.php can identify what to do with each of the form inputs:
  - `<input type="text" name="fullname" size="30">` to `<input type="text" name="FullName" size="30">`
  - `<input type="email" name="useremail" pattern=".+rit.edu" size="30">` to `<input type="email" name="EmailAddr" pattern=".+rit.edu" size="30">`
  - `<textarea name="comments">` to `<textarea name="mesg">`

7. Feel free to modify the form to look the way you'd like, or to add additional input fields. 

## Test the Form
Use an FTP client (FileZilla on the lab computers) to upload the entire formmail folder (with both HTML files, the CSS file, and the PHP script) to your banjo.rit.edu or cad.rit.edu account. 

*IMPORTANT: On banjo, you need to change the permissions on the formmail.php file to ***700***, or it won't run!*

Go to the form.html page on your account (people.rit.edu/youruserid/formmail/form.html, or youruserid.cad.rit.edu/formmail/form.html), fill out the form, and click the submit button. If everything worked, you should see the following results page:

```
Thanks! We've received your information and, if it's appropriate, we'll be in contact with you soon.
Your form submission was processed by FormMail (9.14), a PHP script available from www.tectite.com.
```

You should also receive an email message that appears to be from you, with the contents of the form in the message. 

## Changing the Success Page
You probably want the user to get to a page that looks a bit nicer than the default. To have the script redirect to success.html, add the following hidden field to your form:

`<input type="hidden" name="good_url" value="success.html" />`

Save it, upload it to the server, and try it again. 

## Beyond the Basics
If you want to customize your form results further, you can look at [sampleform.htm], and/or consult the documentation at https://www.tectite.com/fmdoc/index.php. 

## Submitting Your Work
This exercise should be linked from your landing page with the name "Week 14 Formmail Exercise" by the start of class on Tuesday of week 15. 











